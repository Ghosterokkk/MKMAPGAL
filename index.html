<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Медицинский тест для сотрудников</title>
    <link rel="icon" type="image/png" href="Med.png">
    <style>
        /* Базовые стили */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ed 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #8B0000 0%, #A52A2A 100%);
            color: white;
            padding: 20px 0;
            text-align: center;
            border-radius: 12px 12px 0 0;
            margin-bottom: 20px;
            position: relative;
            box-shadow: 0 4px 15px rgba(139, 0, 0, 0.2);
        }
        
        h1 {
            font-size: 32px;
            margin-bottom: 10px;
            color: #ffffff;
            text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 15px #ff0000, 0 0 20px #ff0000;
            animation: neonGlow 2s ease-in-out infinite alternate;
        }
        
        @keyframes neonGlow {
            from {
                text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 15px #ff0000, 0 0 20px #ff0000;
            }
            to {
                text-shadow: 0 0 10px #fff, 0 0 15px #fff, 0 0 20px #ff0000, 0 0 25px #ff0000, 0 0 30px #ff0000;
            }
        }
        
        .description {
            font-size: 16px;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-bottom: 20px;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        input[type="email"],
        input[type="text"],
        input[type="number"],
        input[type="password"],
        textarea,
        select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
            background: #f9f9f9;
        }
        
        input:focus,
        textarea:focus,
        select:focus {
            border-color: #8B0000;
            outline: none;
            background: white;
            box-shadow: 0 0 0 3px rgba(139, 0, 0, 0.1);
        }
        
        .btn {
            background: linear-gradient(135deg, #8B0000 0%, #A52A2A 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-block;
            text-align: center;
            box-shadow: 0 4px 10px rgba(139, 0, 0, 0.2);
        }
        
        .btn:hover {
            background: linear-gradient(135deg, #A52A2A 0%, #8B0000 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(139, 0, 0, 0.3);
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #5f6368 0%, #4a4d52 100%);
        }
        
        .btn-secondary:hover {
            background: linear-gradient(135deg, #4a4d52 0%, #5f6368 100%);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #d93025 0%, #c5221f 100%);
        }
        
        .btn-danger:hover {
            background: linear-gradient(135deg, #c5221f 0%, #d93025 100%);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #0b8043 0%, #096b38 100%);
        }
        
        .btn-success:hover {
            background: linear-gradient(135deg, #096b38 0%, #0b8043 100%);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f9ab00 0%, #e09a00 100%);
            color: #333;
        }
        
        .btn-warning:hover {
            background: linear-gradient(135deg, #e09a00 0%, #f9ab00 100%);
        }
        
        .btn-profile {
            background: linear-gradient(135deg, #1a73e8 0%, #0d5bb9 100%);
        }
        
        .btn-profile:hover {
            background: linear-gradient(135deg, #0d5bb9 0%, #1a73e8 100%);
        }
        
        .test-section {
            display: none;
        }
        
        .question {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .question:last-child {
            border-bottom: none;
        }
        
        .question-text {
            font-weight: 600;
            margin-bottom: 15px;
            font-size: 18px;
            color: #333;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .option {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            background: #f9f9f9;
        }
        
        .option:hover {
            background: #f0f0f0;
            transform: translateX(5px);
        }
        
        .option.selected {
            background: #ffe6e6;
            border-color: #8B0000;
            box-shadow: 0 2px 8px rgba(139, 0, 0, 0.1);
        }
        
        .option input {
            margin-right: 10px;
        }
        
        .results {
            text-align: center;
            padding: 30px;
        }
        
        .score {
            font-size: 28px;
            font-weight: 700;
            color: #8B0000;
            margin: 20px 0;
        }
        
        .message {
            font-size: 18px;
            margin-bottom: 20px;
        }
        
        .hidden {
            display: none;
        }
        
        .error {
            color: #d93025;
            font-size: 14px;
            margin-top: 5px;
            padding: 8px 12px;
            background: #fce8e6;
            border-radius: 6px;
            border-left: 4px solid #d93025;
        }
        
        .success {
            color: #0b8043;
            font-size: 14px;
            margin-top: 5px;
            padding: 8px 12px;
            background: #e6f4ea;
            border-radius: 6px;
            border-left: 4px solid #0b8043;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            color: #666;
            font-size: 14px;
        }
        
        .admin-btn, .profile-btn {
            position: absolute;
            top: 20px;
            padding: 10px 15px;
            font-size: 14px;
        }
        
        .admin-btn {
            right: 20px;
        }
        
        .profile-btn {
            right: 180px;
            display: none; /* Скрыта по умолчанию */
        }
        
        .timer {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
            padding: 12px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .timer.warning {
            background: linear-gradient(135deg, #fce8e6 0%, #f8d7da 100%);
            color: #d93025;
            border-color: #f5c6cb;
        }
        
        .question-timer {
            font-size: 14px;
            color: #5f6368;
            margin-bottom: 10px;
        }
        
        .admin-panel, .profile-panel {
            display: none;
        }
        
        .question-item {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            background: #f8f9fa;
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .question-actions {
            display: flex;
            gap: 10px;
        }
        
        .option-input {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .option-input input {
            flex: 1;
            margin-right: 10px;
        }
        
        .correct-option {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }
        
        .correct-option select {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        
        .tab.active {
            border-bottom-color: #8B0000;
            font-weight: 600;
            color: #8B0000;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .question-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        .question-counter {
            text-align: center;
            margin-bottom: 15px;
            font-weight: 600;
            color: #555;
        }
        
        .login-form {
            max-width: 400px;
            margin: 0 auto;
        }
        
        .time-expired {
            background: linear-gradient(135deg, #fce8e6 0%, #f8d7da 100%);
            border: 1px solid #f28b82;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .results-details {
            text-align: left;
            margin-top: 30px;
        }
        
        .result-item {
            margin-bottom: 25px;
            padding: 15px;
            border-radius: 8px;
            background: #f8f9fa;
        }
        
        .result-item.correct {
            border-left: 4px solid #0b8043;
        }
        
        .result-item.incorrect {
            border-left: 4px solid #d93025;
        }
        
        .result-item.unanswered {
            border-left: 4px solid #5f6368;
        }
        
        .result-question {
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .result-answer {
            margin-bottom: 5px;
        }
        
        .correct-answer {
            color: #0b8043;
            font-weight: 600;
        }
        
        .user-answer {
            color: #8B0000;
        }
        
        .incorrect-answer {
            color: #d93025;
            font-weight: 600;
        }
        
        .unanswered {
            color: #5f6368;
            font-style: italic;
        }
        
        .results-summary {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .summary-item {
            text-align: center;
        }
        
        .summary-value {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .summary-label {
            font-size: 14px;
            color: #5f6368;
        }
        
        .user-item {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            background: #f8f9fa;
        }
        
        .user-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .user-actions {
            display: flex;
            gap: 10px;
        }
        
        .user-info {
            margin-bottom: 10px;
        }
        
        .user-role {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .role-doctor {
            background: linear-gradient(135deg, #d93025 0%, #c5221f 100%);
            color: white;
        }
        
        .role-medic {
            background: linear-gradient(135deg, #1a73e8 0%, #0d5bb9 100%);
            color: white;
        }
        
        .role-sanitary {
            background: linear-gradient(135deg, #f9ab00 0%, #e09a00 100%);
            color: black;
        }
        
        .role-admin {
            background: linear-gradient(135deg, #8B0000 0%, #A52A2A 100%);
            color: white;
        }
        
        .user-stats {
            font-size: 14px;
            color: #5f6368;
        }
        
        .user-assignments {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #ddd;
        }
        
        .assignment-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .assignment-item:last-child {
            border-bottom: none;
        }

        .question-editor {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .question-editor h3 {
            margin-bottom: 15px;
            color: #8B0000;
        }
        
        .option-editor {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .option-editor input {
            flex: 1;
            margin-right: 10px;
        }
        
        .option-editor .btn {
            padding: 8px 12px;
            font-size: 14px;
        }
        
        .time-input {
            width: 100px;
            margin-right: 10px;
        }
        
        .question-time {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }
        
        .question-time label {
            margin-right: 10px;
            margin-bottom: 0;
        }
        
        .firebase-status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 1000;
        }
        
        .firebase-connected {
            background: linear-gradient(135deg, #0b8043 0%, #096b38 100%);
            color: white;
        }
        
        .firebase-disconnected {
            background: linear-gradient(135deg, #d93025 0%, #c5221f 100%);
            color: white;
        }
        
        .user-editor {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .user-editor h3 {
            margin-bottom: 15px;
            color: #8B0000;
        }
        
        .back-btn {
            background: linear-gradient(135deg, #5f6368 0%, #4a4d52 100%);
            margin-bottom: 15px;
        }
        
        .back-btn:hover {
            background: linear-gradient(135deg, #4a4d52 0%, #5f6368 100%);
        }
        
        .user-answer.correct {
            color: #0b8043;
            font-weight: 600;
        }
        
        /* Стили для профиля пользователя */
        .profile-panel {
            display: none;
        }
        
        .profile-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8B0000 0%, #A52A2A 100%);
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 36px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(139, 0, 0, 0.3);
        }
        
        .profile-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .profile-field {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .profile-field label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #555;
        }
        
        .profile-field span {
            display: block;
            padding: 5px 0;
            font-size: 16px;
        }
        
        .profile-role {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 5px;
        }
        
        .change-password-form {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .test-selection {
            display: none;
        }
        
        .test-option {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .test-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            border-color: #8B0000;
        }
        
        .test-option.selected {
            background: #ffe6e6;
            border-color: #8B0000;
            box-shadow: 0 4px 15px rgba(139, 0, 0, 0.1);
        }
        
        .test-option.completed {
            background: #e6ffe6;
            border-color: #0b8043;
        }
        
        .test-option.disabled {
            background: #f5f5f5;
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .test-status {
            font-size: 14px;
            margin-top: 5px;
            padding: 5px 10px;
            border-radius: 4px;
            display: inline-block;
        }
        
        .retry-request {
            margin-top: 10px;
            padding: 10px;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
        }
        
        .request-pending {
            background: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }
        
        .request-approved {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        
        .request-rejected {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        
        .profile-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
            
            .card {
                padding: 20px;
            }
            
            .admin-btn, .profile-btn {
                position: static;
                margin-top: 10px;
            }
            
            .question-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .question-actions {
                margin-top: 10px;
                width: 100%;
                justify-content: space-between;
            }
            
            .results-summary {
                flex-direction: column;
                gap: 15px;
            }
            
            .user-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .user-actions {
                margin-top: 10px;
                width: 100%;
                justify-content: space-between;
            }
            
            .option-editor {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .option-editor input {
                width: 100%;
                margin-right: 0;
                margin-bottom: 5px;
            }
            
            .firebase-status {
                position: static;
                margin-bottom: 10px;
            }
            
            .profile-info {
                grid-template-columns: 1fr;
            }
            
            .profile-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="firebase-status hidden" id="firebase-status"></div>
    
    <div class="container">
        <header>
            <h1>Медицинский Тест</h1>
            <p class="description">Система тестирования медицинских знаний</p>
            <button class="btn profile-btn" id="profile-toggle">Профиль</button>
            <button class="btn admin-btn" id="admin-toggle">Режим администратора</button>
        </header>
        
        <!-- Панель пользователя -->
        <div id="user-panel">
            <div class="card" id="login-section">
                <h2>Вход в систему</h2>
                <p>Введите ваш логин и пароль для доступа к тестированию</p>
                
                <div class="form-group">
                    <label for="username">Логин</label>
                    <input type="text" id="username" placeholder="Введите ваш логин" required>
                </div>
                
                <div class="form-group">
                    <label for="password">Пароль</label>
                    <input type="password" id="password" placeholder="Введите ваш пароль" required>
                </div>
                
                <div class="error hidden" id="login-error">Неверный логин или пароль</div>
                <div class="error hidden" id="no-assignment-error">Для вашего аккаунта не назначен тест. Обратитесь к администратору.</div>
                
                <button class="btn btn-block" id="login-btn">Войти</button>
            </div>
            
            <!-- Выбор теста -->
            <div class="card test-selection" id="test-selection">
                <h2>Выбор теста</h2>
                <p>Выберите тест для прохождения. Каждый тест можно пройти только один раз.</p>
                
                <div id="available-tests">
                    <!-- Доступные тесты будут добавлены динамически -->
                </div>
                
                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button class="btn" id="start-selected-test">Начать выбранный тест</button>
                    <button class="btn btn-secondary" id="back-to-tests">Назад</button>
                </div>
            </div>
            
            <div class="card test-section" id="test-section">
                <div class="timer" id="timer">Общее время: 30:00</div>
                <div class="question-timer" id="question-timer">Время на вопрос: 60 сек.</div>
                <div class="question-counter" id="question-counter">Вопрос 1 из 3</div>
                
                <h2>Медицинский тест</h2>
                <p>Ответьте на все вопросы. После завершения вы увидите результаты.</p>
                
                <div id="questions-container">
                    <!-- Вопросы будут добавлены динамически -->
                </div>
                
                <div class="question-navigation">
                    <button class="btn" id="next-question">Следующий вопрос</button>
                </div>
                
                <button class="btn btn-block" id="submit-test" style="margin-top: 20px; display: none;">Завершить тест</button>
            </div>
            
            <div class="card test-section" id="results-section">
                <div class="results">
                    <h2>Результаты теста</h2>
                    <p class="message" id="result-message"></p>
                    <div class="score" id="score"></div>
                    <p>Пользователь: <span id="current-user"></span></p>
                    
                    <div class="results-summary" id="results-summary">
                        <!-- Сводка результатов будет добавлена динамически -->
                    </div>
                    
                    <div class="results-details" id="results-details">
                        <!-- Детали результатов будут добавлены динамически -->
                    </div>
                    
                    <div class="profile-actions">
                        <button class="btn" id="restart-test">Пройти другой тест</button>
                        <button class="btn btn-secondary" id="logout-btn">Выйти</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Профиль пользователя -->
        <div class="profile-panel" id="profile-panel">
            <button class="btn back-btn" id="back-from-profile">← Назад к тестам</button>
            
            <div class="card">
                <div class="profile-header">
                    <div class="profile-avatar" id="profile-avatar">
                        <!-- Первая буква имени пользователя -->
                    </div>
                    <h2>Профиль пользователя</h2>
                </div>
                
                <div class="profile-info">
                    <div class="profile-field">
                        <label>Имя пользователя</label>
                        <span id="profile-username"></span>
                    </div>
                    
                    <div class="profile-field">
                        <label>Роль</label>
                        <span id="profile-role"></span>
                    </div>
                    
                    <div class="profile-field">
                        <label>Подразделение</label>
                        <span id="profile-unit"></span>
                    </div>
                    
                    <div class="profile-field">
                        <label>Дата регистрации</label>
                        <span id="profile-registration-date"></span>
                    </div>
                </div>
                
                <div class="change-password-form">
                    <h3>Смена пароля</h3>
                    
                    <div class="form-group">
                        <label for="current-password">Текущий пароль</label>
                        <input type="password" id="current-password" placeholder="Введите текущий пароль">
                    </div>
                    
                    <div class="form-group">
                        <label for="new-password">Новый пароль</label>
                        <input type="password" id="new-password" placeholder="Введите новый пароль">
                    </div>
                    
                    <div class="form-group">
                        <label for="confirm-password">Подтвердите новый пароль</label>
                        <input type="password" id="confirm-password" placeholder="Повторите новый пароль">
                    </div>
                    
                    <div class="error hidden" id="password-change-error"></div>
                    <div class="success hidden" id="password-change-success">Пароль успешно изменен!</div>
                    
                    <button class="btn" id="change-password-btn">Сменить пароль</button>
                </div>
            </div>
        </div>
        
        <!-- Админ-панель -->
        <div class="admin-panel" id="admin-panel">
            <!-- Кнопка возврата в режим пользователя -->
            <button class="btn back-btn" id="back-to-user">← Вернуться к входу в систему</button>
            
            <div class="card" id="admin-login">
                <h2>Вход для администратора</h2>
                <div class="login-form">
                    <div class="form-group">
                        <label for="admin-username">Логин администратора</label>
                        <input type="text" id="admin-username" placeholder="Введите логин">
                    </div>
                    
                    <div class="form-group">
                        <label for="admin-password">Пароль администратора</label>
                        <input type="password" id="admin-password" placeholder="Введите пароль">
                    </div>
                    
                    <div class="error hidden" id="admin-login-error">Неверный логин или пароль</div>
                    
                    <button class="btn btn-block" id="admin-login-btn">Войти как администратор</button>
                </div>
            </div>
            
            <div class="admin-content hidden" id="admin-content">
                <div class="tabs">
                    <div class="tab active" data-tab="users">Управление пользователями</div>
                    <div class="tab" data-tab="questions">Управление вопросами</div>
                    <div class="tab" data-tab="assignments">Назначение тестов</div>
                    <div class="tab" data-tab="results">Результаты тестов</div>
                    <div class="tab" data-tab="retry-requests">Запросы на перепрохождение</div>
                    <div class="tab" data-tab="settings">Настройки системы</div>
                </div>
                
                <div class="tab-content active" id="users-tab">
                    <div class="card">
                        <h2>Управление пользователями</h2>
                        <p>Создавайте и управляйте учетными записями пользователей.</p>
                        
                        <div class="form-group">
                            <h3>Добавить нового пользователя</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 10px; align-items: end;">
                                <div>
                                    <label>Логин</label>
                                    <input type="text" id="new-user-login" placeholder="Логин пользователя">
                                </div>
                                <div>
                                    <label>Пароль</label>
                                    <input type="password" id="new-user-password" placeholder="Пароль пользователя">
                                </div>
                                <div>
                                    <button class="btn btn-success" id="add-user">Добавить пользователя</button>
                                </div>
                            </div>
                            <div class="success hidden" id="user-add-success">Пользователь успешно добавлен!</div>
                            <div class="error hidden" id="user-add-error"></div>
                        </div>

                        <!-- Редактор пользователей -->
                        <div class="user-editor hidden" id="user-editor">
                            <h3>Редактирование пользователя</h3>
                            
                            <div class="form-group">
                                <label for="edit-user-login">Логин</label>
                                <input type="text" id="edit-user-login" placeholder="Логин пользователя">
                            </div>
                            
                            <div class="form-group">
                                <label for="edit-user-password">Пароль</label>
                                <input type="password" id="edit-user-password" placeholder="Новый пароль (оставьте пустым, чтобы не менять)">
                            </div>
                            
                            <div class="form-group">
                                <label for="edit-user-role">Роль</label>
                                <select id="edit-user-role">
                                    <option value="doctor">Полевой Врач</option>
                                    <option value="medic">Полевой Фельдшер</option>
                                    <option value="sanitary">Полевой Санитар</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="edit-user-unit">Подразделение</label>
                                <select id="edit-user-unit">
                                    <option value="41">41</option>
                                    <option value="212">212</option>
                                    <option value="501">501</option>
                                    <option value="CG">CG</option>
                                    <option value="СТ">СТ</option>
                                    <option value="Отсутствует">Отсутствует</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <button class="btn btn-success" id="save-user">Сохранить изменения</button>
                                <button class="btn btn-secondary" id="cancel-user-edit">Отмена</button>
                            </div>
                        </div>
                        
                        <div id="users-list">
                            <!-- Список пользователей будет добавлен динамически -->
                        </div>
                    </div>
                </div>
                
                <!-- Остальные вкладки админ-панели -->
                <div class="tab-content" id="questions-tab">
                    <div class="card">
                        <h2>Управление вопросами</h2>
                        <p>Создавайте наборы вопросов для тестирования.</p>
                        <p>Функционал в разработке...</p>
                    </div>
                </div>
                
                <div class="tab-content" id="assignments-tab">
                    <div class="card">
                        <h2>Назначение тестов</h2>
                        <p>Назначайте тесты пользователям.</p>
                        <p>Функционал в разработке...</p>
                    </div>
                </div>
                
                <div class="tab-content" id="results-tab">
                    <div class="card">
                        <h2>Результаты тестов</h2>
                        <p>Просматривайте результаты тестов.</p>
                        <p>Функционал в разработке...</p>
                    </div>
                </div>
                
                <div class="tab-content" id="retry-requests-tab">
                    <div class="card">
                        <h2>Запросы на перепрохождение</h2>
                        <p>Управляйте запросами на перепрохождение тестов.</p>
                        <p>Функционал в разработке...</p>
                    </div>
                </div>
                
                <div class="tab-content" id="settings-tab">
                    <div class="card">
                        <h2>Настройки системы</h2>
                        <p>Настройте параметры системы.</p>
                        <p>Функционал в разработке...</p>
                    </div>
                </div>
                
                <div class="card">
                    <button class="btn btn-secondary btn-block" id="user-mode">Вернуться в режим пользователя</button>
                    <button class="btn btn-danger btn-block" id="admin-logout" style="margin-top: 10px;">Выйти из админ-панели</button>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Система Тестирования Медицинского Корпуса © 2025</p>
        </footer>
    </div>

    <script>
        // 🔥 КОНФИГУРАЦИЯ FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyDN6TzyGdBnJoJZCZx3uKs6ZMCYnfU4TzA",
            authDomain: "testmk-8909d.firebaseapp.com",
            projectId: "testmk-8909d",
            storageBucket: "testmk-8909d.firebasestorage.app",
            messagingSenderId: "752962987677",
            appId: "1:752962987677:web:e2c285d7a743595e779674"
        };

        // Инициализация Firebase
        let db;
        let auth;
        let firebaseConnected = false;

        try {
            if (firebaseConfig.apiKey && !firebaseConfig.apiKey.includes("your-")) {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                auth = firebase.auth();
                firebaseConnected = true;
                console.log("✅ Firebase подключен");
                updateFirebaseStatus(true);
                
                // Создаем администратора по умолчанию при первом запуске
                createDefaultAdmin();
            } else {
                console.log("⚠️ Firebase не настроен, используется localStorage");
                updateFirebaseStatus(false);
            }
        } catch (error) {
            console.error("❌ Ошибка Firebase:", error);
            updateFirebaseStatus(false);
        }

        // Создание администратора по умолчанию
        async function createDefaultAdmin() {
            try {
                const users = await loadUsers();
                const adminExists = users.some(user => user.role === 'admin');
                
                if (!adminExists) {
                    const defaultAdmin = {
                        login: 'admin',
                        password: 'admin123',
                        role: 'admin',
                        unit: 'Отсутствует',
                        registrationDate: new Date().toISOString()
                    };
                    
                    await saveUser(defaultAdmin);
                    console.log('✅ Администратор по умолчанию создан');
                }
            } catch (error) {
                console.error('❌ Ошибка создания администратора по умолчанию:', error);
            }
        }

        function updateFirebaseStatus(connected) {
            const statusElement = document.getElementById('firebase-status');
            if (connected) {
                statusElement.textContent = 'Firebase: Подключено';
                statusElement.className = 'firebase-status firebase-connected';
                statusElement.classList.remove('hidden');
            } else {
                statusElement.textContent = 'Firebase: Не подключено (локальный режим)';
                statusElement.className = 'firebase-status firebase-disconnected';
                statusElement.classList.remove('hidden');
            }
        }

        // Firebase функции
        async function loadUsers() {
            try {
                if (!firebaseConnected) {
                    return getLocalUsers();
                }

                const snapshot = await db.collection('users').get();
                const users = [];
                
                snapshot.forEach(doc => {
                    users.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                return users;
            } catch (error) {
                console.error('❌ Ошибка загрузки пользователей:', error);
                return getLocalUsers();
            }
        }

        async function saveUser(user) {
            try {
                if (!firebaseConnected) {
                    return saveUserToLocal(user);
                }

                if (user.id) {
                    await db.collection('users').doc(user.id).update(user);
                } else {
                    const docRef = await db.collection('users').add(user);
                    user.id = docRef.id;
                }
                
                saveUserToLocal(user);
                return user;
            } catch (error) {
                console.error('❌ Ошибка сохранения пользователя:', error);
                saveUserToLocal(user);
                throw error;
            }
        }

        // Функции для работы с localStorage
        function getLocalUsers() {
            try {
                const users = localStorage.getItem('medicalTestUsers');
                return users ? JSON.parse(users) : [];
            } catch (error) {
                console.error('❌ Ошибка получения пользователей из localStorage:', error);
                return [];
            }
        }

        function saveUserToLocal(user) {
            try {
                const users = getLocalUsers();
                const existingIndex = users.findIndex(u => u.id === user.id);
                
                if (existingIndex >= 0) {
                    users[existingIndex] = user;
                } else {
                    users.push(user);
                }
                
                localStorage.setItem('medicalTestUsers', JSON.stringify(users));
            } catch (error) {
                console.error('❌ Ошибка сохранения пользователя в localStorage:', error);
            }
        }

        // Основная логика приложения
        let currentUser = null;

        // DOM элементы
        const userPanel = document.getElementById('user-panel');
        const profilePanel = document.getElementById('profile-panel');
        const adminPanel = document.getElementById('admin-panel');
        const adminToggle = document.getElementById('admin-toggle');
        const profileToggle = document.getElementById('profile-toggle');
        const backToUserBtn = document.getElementById('back-to-user');
        const backFromProfileBtn = document.getElementById('back-from-profile');
        const backToTestsBtn = document.getElementById('back-to-tests');
        const adminLogin = document.getElementById('admin-login');
        const adminContent = document.getElementById('admin-content');
        const adminLoginBtn = document.getElementById('admin-login-btn');
        const adminLogoutBtn = document.getElementById('admin-logout');
        const userModeBtn = document.getElementById('user-mode');
        const loginSection = document.getElementById('login-section');
        const testSelectionSection = document.getElementById('test-selection');
        const testSection = document.getElementById('test-section');
        const resultsSection = document.getElementById('results-section');
        const loginBtn = document.getElementById('login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const changePasswordBtn = document.getElementById('change-password-btn');
        const startSelectedTestBtn = document.getElementById('start-selected-test');
        const restartTestBtn = document.getElementById('restart-test');
        const addUserBtn = document.getElementById('add-user');

        // Инициализация приложения
        document.addEventListener('DOMContentLoaded', function() {
            showLoginSection();
            initEventListeners();
        });

        function initEventListeners() {
            // Кнопка профиля
            profileToggle.addEventListener('click', function() {
                if (currentUser) {
                    showProfilePanel();
                }
            });

            // Кнопка администратора
            adminToggle.addEventListener('click', function() {
                showAdminPanel();
            });

            // Кнопка возврата из профиля
            backFromProfileBtn.addEventListener('click', function() {
                showTestSelection();
            });

            // Кнопка возврата из выбора тестов
            backToTestsBtn.addEventListener('click', function() {
                showTestSelection();
            });

            // Кнопка возврата к пользовательскому режиму
            backToUserBtn.addEventListener('click', function() {
                showLoginSection();
            });

            // Кнопка входа
            loginBtn.addEventListener('click', function() {
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                authenticateUser(username, password);
            });

            // Кнопка выхода
            logoutBtn.addEventListener('click', function() {
                logoutUser();
            });

            // Кнопка смены пароля
            changePasswordBtn.addEventListener('click', function() {
                changePassword();
            });

            // Кнопка начала теста
            startSelectedTestBtn.addEventListener('click', function() {
                startTest();
            });

            // Кнопка повторного тестирования
            restartTestBtn.addEventListener('click', function() {
                showTestSelection();
            });

            // Кнопка входа в админ-панель
            adminLoginBtn.addEventListener('click', function() {
                const username = document.getElementById('admin-username').value;
                const password = document.getElementById('admin-password').value;
                authenticateAdmin(username, password);
            });

            // Кнопка выхода из админ-панели
            adminLogoutBtn.addEventListener('click', function() {
                adminLogin.classList.remove('hidden');
                adminContent.classList.add('hidden');
                document.getElementById('admin-username').value = '';
                document.getElementById('admin-password').value = '';
                document.getElementById('admin-login-error').classList.add('hidden');
            });

            // Кнопка возврата в пользовательский режим
            userModeBtn.addEventListener('click', function() {
                showLoginSection();
            });

            // Кнопка добавления пользователя
            addUserBtn.addEventListener('click', function() {
                addUser();
            });
        }

        // Аутентификация пользователя
        async function authenticateUser(username, password) {
            try {
                const users = await loadUsers();
                const user = users.find(u => u.login === username && u.password === password);
                
                if (user) {
                    currentUser = user;
                    showTestSelection();
                    document.getElementById('login-error').classList.add('hidden');
                    // Показываем кнопку профиля после входа
                    profileToggle.style.display = 'block';
                } else {
                    document.getElementById('login-error').classList.remove('hidden');
                }
            } catch (error) {
                console.error('❌ Ошибка аутентификации:', error);
                document.getElementById('login-error').classList.remove('hidden');
            }
        }

        // Аутентификация администратора
        async function authenticateAdmin(username, password) {
            try {
                const users = await loadUsers();
                const admin = users.find(u => u.login === username && u.password === password && u.role === 'admin');
                
                if (admin) {
                    adminLogin.classList.add('hidden');
                    adminContent.classList.remove('hidden');
                    document.getElementById('admin-login-error').classList.add('hidden');
                } else {
                    document.getElementById('admin-login-error').classList.remove('hidden');
                }
            } catch (error) {
                console.error('❌ Ошибка аутентификации администратора:', error);
                document.getElementById('admin-login-error').classList.remove('hidden');
            }
        }

        // Выход пользователя
        function logoutUser() {
            currentUser = null;
            localStorage.removeItem('currentMedicalTestUser');
            showLoginSection();
            // Скрываем кнопку профиля при выходе
            profileToggle.style.display = 'none';
        }

        // Отображение разделов
        function showLoginSection() {
            userPanel.style.display = 'block';
            profilePanel.style.display = 'none';
            adminPanel.style.display = 'none';
            loginSection.style.display = 'block';
            testSelectionSection.style.display = 'none';
            testSection.style.display = 'none';
            resultsSection.style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('login-error').classList.add('hidden');
            adminToggle.style.display = 'block';
        }

        function showTestSelection() {
            userPanel.style.display = 'block';
            profilePanel.style.display = 'none';
            adminPanel.style.display = 'none';
            loginSection.style.display = 'none';
            testSelectionSection.style.display = 'block';
            testSection.style.display = 'none';
            resultsSection.style.display = 'none';
        }

        function showProfilePanel() {
            userPanel.style.display = 'none';
            profilePanel.style.display = 'block';
            adminPanel.style.display = 'none';
            loadProfileData();
        }

        function showAdminPanel() {
            userPanel.style.display = 'none';
            profilePanel.style.display = 'none';
            adminPanel.style.display = 'block';
            adminLogin.classList.remove('hidden');
            adminContent.classList.add('hidden');
        }

        // Загрузка данных профиля
        function loadProfileData() {
            if (!currentUser) return;
            
            // Устанавливаем аватар (первая буква имени)
            document.getElementById('profile-avatar').textContent = currentUser.login.charAt(0).toUpperCase();
            
            document.getElementById('profile-username').textContent = currentUser.login;
            
            let roleDisplayName = '';
            let roleClass = '';
            
            if (currentUser.role === 'doctor') {
                roleDisplayName = 'Полевой Врач';
                roleClass = 'role-doctor';
            } else if (currentUser.role === 'medic') {
                roleDisplayName = 'Полевой Фельдшер';
                roleClass = 'role-medic';
            } else if (currentUser.role === 'sanitary') {
                roleDisplayName = 'Полевой Санитар';
                roleClass = 'role-sanitary';
            } else if (currentUser.role === 'admin') {
                roleDisplayName = 'Администратор';
                roleClass = 'role-admin';
            } else {
                roleDisplayName = currentUser.role;
                roleClass = 'role-user';
            }
            
            document.getElementById('profile-role').innerHTML = `
                ${roleDisplayName} 
                <span class="profile-role ${roleClass}">${roleDisplayName}</span>
            `;
            
            document.getElementById('profile-unit').textContent = currentUser.unit || 'Отсутствует';
            
            const registrationDate = currentUser.registrationDate ? 
                new Date(currentUser.registrationDate).toLocaleDateString('ru-RU') : 
                'Неизвестно';
            document.getElementById('profile-registration-date').textContent = registrationDate;
            
            // Очищаем форму смены пароля
            document.getElementById('current-password').value = '';
            document.getElementById('new-password').value = '';
            document.getElementById('confirm-password').value = '';
            document.getElementById('password-change-error').classList.add('hidden');
            document.getElementById('password-change-success').classList.add('hidden');
        }

        // Смена пароля
        async function changePassword() {
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            const errorElement = document.getElementById('password-change-error');
            const successElement = document.getElementById('password-change-success');
            
            errorElement.classList.add('hidden');
            successElement.classList.add('hidden');
            
            if (!currentPassword || !newPassword || !confirmPassword) {
                errorElement.textContent = 'Заполните все поля';
                errorElement.classList.remove('hidden');
                return;
            }
            
            if (currentPassword !== currentUser.password) {
                errorElement.textContent = 'Текущий пароль неверен';
                errorElement.classList.remove('hidden');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                errorElement.textContent = 'Новые пароли не совпадают';
                errorElement.classList.remove('hidden');
                return;
            }
            
            if (newPassword.length < 4) {
                errorElement.textContent = 'Новый пароль должен содержать не менее 4 символов';
                errorElement.classList.remove('hidden');
                return;
            }
            
            try {
                const updatedUser = {
                    ...currentUser,
                    password: newPassword
                };
                
                await saveUser(updatedUser);
                currentUser = updatedUser;
                localStorage.setItem('currentMedicalTestUser', JSON.stringify(currentUser));
                
                successElement.classList.remove('hidden');
                
                // Очищаем форму
                document.getElementById('current-password').value = '';
                document.getElementById('new-password').value = '';
                document.getElementById('confirm-password').value = '';
                
            } catch (error) {
                console.error('❌ Ошибка смены пароля:', error);
                errorElement.textContent = 'Ошибка при смене пароля';
                errorElement.classList.remove('hidden');
            }
        }

        // Добавление пользователя
        async function addUser() {
            const login = document.getElementById('new-user-login').value;
            const password = document.getElementById('new-user-password').value;
            
            if (!login || !password) {
                document.getElementById('user-add-error').textContent = 'Заполните все поля';
                document.getElementById('user-add-error').classList.remove('hidden');
                return;
            }
            
            try {
                const users = await loadUsers();
                
                const existingUser = users.find(u => u.login === login);
                if (existingUser) {
                    document.getElementById('user-add-error').textContent = 'Пользователь с таким логином уже существует';
                    document.getElementById('user-add-error').classList.remove('hidden');
                    return;
                }
                
                const newUser = {
                    login: login,
                    password: password,
                    role: 'doctor',
                    unit: 'Отсутствует',
                    registrationDate: new Date().toISOString()
                };
                
                await saveUser(newUser);
                
                document.getElementById('user-add-success').classList.remove('hidden');
                document.getElementById('user-add-error').classList.add('hidden');
                document.getElementById('new-user-login').value = '';
                document.getElementById('new-user-password').value = '';
                
                setTimeout(() => {
                    document.getElementById('user-add-success').classList.add('hidden');
                }, 3000);
                
            } catch (error) {
                console.error('❌ Ошибка добавления пользователя:', error);
                document.getElementById('user-add-error').textContent = 'Ошибка при добавлении пользователя';
                document.getElementById('user-add-error').classList.remove('hidden');
            }
        }

        // Запуск теста (заглушка)
        function startTest() {
            alert('Функционал тестирования в разработке');
        }
    </script>
</body>
</html>
